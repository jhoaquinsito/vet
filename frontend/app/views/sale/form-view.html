<form name="saleForm" novalidate>
    <div class="panel panel-default">
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group form-group-sm">
                        <label class="control-label">Cliente</label>
                        <input type="text" class="form-control" name="client" ng-model="form.sale.person" onkeypress="return this.value.length < 130" ng-change="addFormDropdownValue('client')" bs-options="client.id as client.name for client in form.clients" bs-typeahead>
                    </div>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group form-group-sm">
                        <label class="control-label">Agregar producto</label>
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" name="product" onkeypress="return this.value.length < 100" ng-model="form.productBatchCode" ng-keyup="addSaleLineAction()">
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-sm btn-info" ng-click="showProductSearchModal()"><i class="fa fa-search"></i></button>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <table class="table table-bordered table-hover table-main">
                        <tr>
                            <th class="col-xs-4">Producto</th>
                            <th class="col-xs-1">Cantidad</th>
                            <th></th>
                            <th class="col-xs-2 col-xs-offset-1">Precio</th>
                            <th class="col-xs-1">Descuento (%)</th>
                            <th class="col-xs-2 col-xs-offset-1 text-right">Sub-total</th>
                        </tr>
                        <tr ng-repeat="saleLine in form.sale.saleLines">
                            <td class="table-cell-input">{{saleLine.product.name}}</td>
                            <td class="table-cell-input">
                                <div class="form-group" ng-class="{'has-error': saleForm['quantity-' + saleLine.product.id].$dirty && saleForm['quantity-' + saleLine.product.id].$error.required}">
                                    <input type="number" class="form-control" name="quantity-{{saleLine.product.id}}" ng-model="saleLine.quantity" required>
                                </div>
                            </td>
                            <td class="table-cell-input">{{saleLine.product.measureUnit.name}}</td>
                            <td class="table-cell-input">${{saleLine.unit_price | number: 2}}</td>
                            <td class="table-cell-input">
                                <div class="form-group" ng-class="{'has-error': saleForm['discount-' + saleLine.product.id].$dirty && saleForm['discount-' + saleLine.product.id].$error.required}">
                                    <input type="number" class="form-control" name="discount-{{saleLine.product.id}}" ng-model="saleLine.discount" required>
                                </div>
                            </td>
                            <td class="table-cell-input text-right">${{(saleLine.unit_price - saleLine.unit_price * saleLine.discount / 100) * saleLine.quantity | number: 2}}</td>
                        </tr>
                        <tr ng-if="form.sale.saleLines.length == 0">
                            <td colspan="5" class="table-cell-empty">Agreg√° productos a tu venta...</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <h3 class="text-right">Total: ${{calculateSaleTotal() | number: 2}}</h3>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group form-group-sm">
                        <label class="control-label">Impresion</label>
                        <select class="form-control" name="invoiced" ng-model="form.sale.invoiced" ng-options="invoiceOption.value as invoiceOption.label for invoiceOption in form.invoiceOptions" required></select>
                    </div>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-4 col-md-offset-1">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group form-group-sm">
                                <label class="control-label">Forma de pago</label>
                                <select class="form-control" name="paied_out" ng-model="form.sale.paied_out" ng-options="paiedOutOption.value as paiedOutOption.label for paiedOutOption in form.paiedOutOptions" required></select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div ng-if="form.sale.paied_out">
                            <div class="col-md-12">
                                <div class="form-group form-group-sm">
                                    <label class="control-label">Paga con</label>
                                    <input type="number" class="form-control" name="settlement-cash-amount" ng-model="form.sale.settlement.amount" >
                                </div>
                            </div>
                            <div class="col-md-12">
                                Vuelto ${{form.sale.settlement.amount - calculateSaleTotal() | number: 2}}
                            </div>
                        </div>
                        <div ng-if="!form.sale.paied_out">
                            <div class="col-md-12">
                                <div class="form-group form-group-sm">
                                    <label class="control-label">Entrega</label>
                                    <input type="number" class="form-control" name="settlement-account-amount" ng-model="form.sale.settlement.amount" >
                                </div>
                            </div>
                            <div class="col-md-12">
                                Saldo actual: to do
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-md-offset-1">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group form-group-sm">
                                <label class="control-label">Nro cheque</label>
                                <input type="text" class="form-control" name="settlement-checknumber" ng-model="form.sale.settlement.checkNumber" >
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group form-group-sm">
                                <label class="control-label">Fecha de vencimiento</label>
                                <input type="text" class="form-control" name="settlement-date" ng-model="form.sale.settlement.date" bs-datepicker>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel-footer">
            <div class="text-right">
                <button type="button" ng-click="saveSaleAction(saleForm)" class="btn btn-icon btn-primary"><i class="fa fa-floppy-o"></i>Registrar</button>
            </div>
        </div>
    </div>
</form>